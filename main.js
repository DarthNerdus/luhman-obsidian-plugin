/*
THIS IS A GENERATED/BUNDLED FILE BY ROLLUP
if you want to view the source visit the plugins github repository
*/

'use strict';

var obsidian = require('obsidian');

/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */

function __awaiter(thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

const lettersIDComponentSuccessors = {
    'a': 'b',
    'b': 'c',
    'c': 'd',
    'd': 'e',
    'e': 'f',
    'f': 'g',
    'g': 'h',
    'h': 'i',
    'i': 'j',
    'j': 'k',
    'k': 'l',
    'l': 'm',
    'm': 'n',
    'n': 'o',
    'o': 'p',
    'p': 'q',
    'q': 'r',
    'r': 's',
    's': 't',
    't': 'u',
    'u': 'v',
    'v': 'w',
    'w': 'x',
    'x': 'y',
    'y': 'z',
    'z': 'aa'
};
class NewZettel extends obsidian.Plugin {
    copyToClipboard(data) {
        const listener = (e) => {
            var _a;
            (_a = e.clipboardData) === null || _a === void 0 ? void 0 : _a.setData('text/plain', data);
            e.preventDefault();
            document.removeEventListener('copy', listener);
        };
        document.addEventListener('copy', listener);
        document.execCommand('copy');
    }
    incrementStringIDComponent(id) {
        let comps = id.split("");
        let last = comps.pop();
        return comps.concat([lettersIDComponentSuccessors[last]]).join("");
    }
    incrementNumberIDComponent(id) {
        return (parseInt(id) + 1).toString();
    }
    isNumber(string) {
        return /^\d+$/.test(string);
    }
    incrementIDComponent(id) {
        if (this.isNumber(id)) {
            return this.incrementNumberIDComponent(id);
        }
        else {
            return this.incrementStringIDComponent(id);
        }
    }
    incrementID(id) {
        var parts = id.match(/([0-9]+|[a-z]+)/g);
        var lastPart = parts.pop();
        return parts.concat([this.incrementIDComponent(lastPart)]).join("");
    }
    parentID(id) {
        var parts = id.match(/([0-9]+|[a-z]+)/g);
        if (parts) {
            parts.pop();
            return parts.join("");
        }
        else {
            return "";
        }
    }
    nextComponentOf(id) {
        var parts = id.match(/([0-9]+|[a-z]+)/g);
        var lastPart = parts.pop();
        if (this.isNumber(lastPart)) {
            return "a";
        }
        else {
            return "1";
        }
    }
    firstChildOf(parentID) {
        return parentID + this.nextComponentOf(parentID);
    }
    idExists(id) {
        return this.app.vault.getMarkdownFiles().filter(function (file) { return file.basename == id; }).length != 0;
    }
    firstAvailableID(startingID) {
        var nextID = startingID;
        while (this.idExists(nextID)) {
            nextID = this.incrementID(nextID);
        }
        return nextID;
    }
    makeNoteForNextSiblingOf(sibling) {
        var nextID = this.firstAvailableID(this.incrementID(sibling.basename));
        this.app.fileManager.getNewFileParent(sibling.path).path + "/" + nextID + ".md";
        return nextID;
    }
    makeNoteForNextChildOf(parent) {
        var childID = this.firstAvailableID(this.firstChildOf(parent.basename));
        this.app.fileManager.getNewFileParent(parent.path).path + "/" + childID + ".md";
        return childID;
    }
    makeNote(path, title, content, placeCursorAtStartOfContent) {
        let app = this.app;
        let titleContent = "# " + title + "\n\n";
        let fullContent = titleContent + content;
        this.app.vault.create(path, fullContent).then(function (file) {
            var _a;
            (_a = app.workspace.activeLeaf) === null || _a === void 0 ? void 0 : _a.openFile(file).then(function (file) {
                var _a;
                let editor = (_a = app.workspace.getActiveViewOfType(obsidian.MarkdownView)) === null || _a === void 0 ? void 0 : _a.editor;
                if (placeCursorAtStartOfContent) {
                    let position = { line: 2, ch: 0 };
                    editor === null || editor === void 0 ? void 0 : editor.setCursor(position);
                }
                else {
                    editor === null || editor === void 0 ? void 0 : editor.exec('goEnd');
                }
            });
        });
    }
    isZettelFile(name) {
        return /^((?:[0-9]+|[a-z]+)+)\.md$/.exec(name) != null;
    }
    makeNoteFunction(idGenerator) {
        var _a;
        var file = this.app.workspace.getActiveFile();
        if (file == null) {
            return;
        }
        if (this.isZettelFile(file.name)) {
            let fileID = file.basename;
            let fileLink = "[[" + fileID + "]]";
            let editor = (_a = this.app.workspace.getActiveViewOfType(obsidian.MarkdownView)) === null || _a === void 0 ? void 0 : _a.editor;
            let selection = editor === null || editor === void 0 ? void 0 : editor.getSelection();
            let nextID = idGenerator.bind(this, file)();
            let nextPath = this.app.fileManager.getNewFileParent(file.path).path + "/" + nextID + ".md";
            let newLink = "[[" + nextID + "]]";
            if (selection) {
                let title = selection.split(/\s+/).map(w => w[0].toUpperCase() + w.slice(1)).join(' ');
                let selectionPos = editor.listSelections()[0];
                let positionCH = Math.max(selectionPos.head.ch, selectionPos.anchor.ch);
                let position = { line: selectionPos.anchor.line, ch: positionCH + 1 };
                editor.replaceRange(" " + newLink, position, position);
                this.makeNote(nextPath, title, fileLink, true);
            }
            else {
                new NewZettelModal(this.app, (title) => {
                    this.insertTextIntoCurrentNote(newLink);
                    this.makeNote(nextPath, title, fileLink, true);
                }).open();
            }
        }
    }
    renameZettel(id, toName) {
        return __awaiter(this, void 0, void 0, function* () {
            let zettel = this.app.vault.getMarkdownFiles().filter((file) => file.basename == id).first();
            if (zettel) {
                yield this.updateLinks(id, toName);
                yield this.app.vault.rename(zettel, zettel.parent.path + toName + "." + zettel.extension);
            }
        });
    }
    updateLinks(fromID, toID) {
        return __awaiter(this, void 0, void 0, function* () {
            let fromLink = "[[" + fromID + "]]";
            let toLink = "[[" + toID + "]]";
            let matchingFiles = [];
            for (const file of this.getZettels()) {
                let contents = yield this.app.vault.read(file);
                if (contents.contains(fromLink)) {
                    matchingFiles = matchingFiles.concat([[file, contents]]);
                }
            }
            for (const [file, contents] of matchingFiles) {
                let newContents = contents.replace(fromLink, toLink);
                yield this.app.vault.modify(file, newContents);
            }
        });
    }
    moveChildrenDown(id) {
        return __awaiter(this, void 0, void 0, function* () {
            let children = this.getDirectChildZettels(id);
            for (const child of children) {
                yield this.moveZettelDown(child.basename);
            }
        });
    }
    moveZettelDown(id) {
        return __awaiter(this, void 0, void 0, function* () {
            this.moveChildrenDown(id);
            yield this.renameZettel(id, this.firstAvailableID(id));
        });
    }
    outdentZettel(id) {
        return __awaiter(this, void 0, void 0, function* () {
            let newID = this.incrementID(this.parentID(id));
            if (this.idExists(newID)) {
                yield this.moveZettelDown(id);
            }
            for (const child of this.getDirectChildZettels(id)) {
                let newChildID = this.firstAvailableID(this.firstChildOf(newID));
                yield this.renameZettel(child.basename, newChildID);
            }
            yield this.renameZettel(id, newID);
        });
    }
    onload() {
        return __awaiter(this, void 0, void 0, function* () {
            console.log('loading New Zettel');
            // this.app.workspace.onLayoutReady(this.initialize);
            this.addCommand({
                id: 'new-sibling-note',
                name: 'New Sibling Zettel Note',
                callback: () => {
                    this.makeNoteFunction(this.makeNoteForNextSiblingOf);
                }
            });
            this.addCommand({
                id: 'new-child-note',
                name: 'New Child Zettel Note',
                callback: () => {
                    this.makeNoteFunction(this.makeNoteForNextChildOf);
                }
            });
            this.addCommand({
                id: 'insert-zettel-link',
                name: 'Insert Zettel Link',
                callback: () => {
                    // let completion = (te)
                    this.getAllNoteTitles().then((titles) => {
                        new ZettelSuggester(this.app, titles, this.currentlySelectedText(), (file) => {
                            this.insertTextIntoCurrentNote("[[" + file.basename + "]]");
                        }).open();
                    });
                }
            });
            this.addCommand({
                id: 'open-zettel',
                name: 'Open Zettel',
                callback: () => {
                    // let completion = (te)
                    this.getAllNoteTitles().then((titles) => {
                        new ZettelSuggester(this.app, titles, this.currentlySelectedText(), (file) => {
                            this.app.workspace.getUnpinnedLeaf().openFile(file);
                        }).open();
                    });
                }
            });
            this.addCommand({
                id: 'open-parent-zettel',
                name: 'Open Parent Zettel',
                callback: () => {
                    let file = this.currentFile();
                    if (file) {
                        this.openZettel(this.parentID(file.basename));
                    }
                }
            });
            this.addCommand({
                id: 'outdent-zettel',
                name: 'Outdent Zettel',
                callback: () => {
                    let file = this.currentFile();
                    if (file) {
                        this.outdentZettel(file.basename);
                    }
                }
            });
        });
    }
    onunload() {
        console.log('unloading New Zettel');
        // this.initialize(true);
    }
    currentFile() {
        var _a;
        return (_a = this.app.workspace.getActiveViewOfType(obsidian.MarkdownView)) === null || _a === void 0 ? void 0 : _a.file;
    }
    openZettel(id) {
        let file = this.app.vault.getMarkdownFiles().filter((file) => file.basename == id).first();
        if (file) {
            this.app.workspace.getUnpinnedLeaf().openFile(file);
        }
    }
    currentlySelectedText() {
        var _a;
        return (_a = this.app.workspace.getActiveViewOfType(obsidian.MarkdownView)) === null || _a === void 0 ? void 0 : _a.editor.getSelection();
    }
    insertTextIntoCurrentNote(text) {
        let view = this.app.workspace.getActiveViewOfType(obsidian.MarkdownView);
        if (view) {
            let editor = view.editor;
            let position;
            if (editor.getSelection()) {
                let selectionPos = editor.listSelections()[0];
                let positionCH = Math.max(selectionPos.head.ch, selectionPos.anchor.ch);
                position = { line: selectionPos.anchor.line, ch: positionCH + 1 };
            }
            else {
                position = editor.getCursor();
            }
            editor.replaceRange(" " + text, position, position);
        }
    }
    getZettels() {
        return this.app.vault.getMarkdownFiles().filter((file) => {
            const ignore = /^[_layouts|templates|scripts]/;
            return file.path.match(ignore) == null;
        });
    }
    getDirectChildZettels(ofParent) {
        return this.getZettels().filter((file) => { return this.parentID(file.basename) == ofParent; });
    }
    getAllNoteTitles() {
        return __awaiter(this, void 0, void 0, function* () {
            const regex = /# (.+)\s*/;
            let titles = new Map();
            for (const file of this.getZettels()) {
                yield this.app.vault.cachedRead(file).then((text) => {
                    let match = text.match(regex);
                    if (match) {
                        titles.set(match[1], file);
                    }
                });
            }
            return titles;
        });
    }
}
class NewZettelModal extends obsidian.Modal {
    constructor(app, completion) {
        super(app);
        this.completion = completion;
    }
    onOpen() {
        let { contentEl } = this;
        contentEl.parentElement.addClass("zettel-modal");
        this.titleEl.setText("New zettel title...");
        let container = contentEl.createEl("div");
        container.addClass("zettel-modal-container");
        let textBox = contentEl.createEl("input", { "type": "text" });
        textBox.addClass("zettel-modal-textbox");
        textBox.id = "zettel-modal-textbox";
        textBox.addEventListener("keydown", (event) => {
            if (event.key == "Enter") {
                event.preventDefault();
                this.goTapped();
            }
        });
        container.append(textBox);
        let button = contentEl.createEl("input", { "type": "button", "value": "GO" });
        button.addClass("zettel-modal-button");
        button.addEventListener("click", (e) => this.goTapped());
        container.append(button);
        contentEl.append(container);
        window.setTimeout(function () {
            textBox.focus();
        }, 0);
    }
    goTapped() {
        let title = this.contentEl.ownerDocument.getElementById("zettel-modal-textbox").value;
        this.completion(title);
        this.close();
    }
}
class ZettelSuggester extends obsidian.SuggestModal {
    constructor(app, titles, search, completion) {
        super(app);
        this.initialQuery = search !== null && search !== void 0 ? search : "";
        this.titles = titles;
        this.completion = completion;
    }
    onOpen() {
        super.onOpen();
        this.inputEl.value = this.initialQuery;
        var event = new Event('input');
        this.inputEl.dispatchEvent(event);
    }
    getSuggestions(query) {
        let sanitisedQuery = query.toLowerCase().replace(" ", "");
        return Array.from(this.titles.keys()).filter((title) => {
            let sanitisedTitle = title.toLowerCase().replace(" ", "");
            return sanitisedTitle.contains(sanitisedQuery);
        });
    }
    renderSuggestion(value, el) {
        el.setText(value);
    }
    onChooseSuggestion(item, evt) {
        this.completion(this.titles.get(item));
    }
}

module.exports = NewZettel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsibm9kZV9tb2R1bGVzL3RzbGliL3RzbGliLmVzNi5qcyIsInNyYy9zcmMvbWFpbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uXHJcblxyXG5QZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnlcclxucHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLlxyXG5cclxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMgV0lUSFxyXG5SRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFlcclxuQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULFxyXG5JTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST01cclxuTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1JcclxuT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUlxyXG5QRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLlxyXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xyXG4vKiBnbG9iYWwgUmVmbGVjdCwgUHJvbWlzZSAqL1xyXG5cclxudmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbihkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2V4dGVuZHMoZCwgYikge1xyXG4gICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcclxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XHJcbiAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgX19hc3NpZ24gPSBmdW5jdGlvbigpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiBfX2Fzc2lnbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3Jlc3QocywgZSkge1xyXG4gICAgdmFyIHQgPSB7fTtcclxuICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSAmJiBlLmluZGV4T2YocCkgPCAwKVxyXG4gICAgICAgIHRbcF0gPSBzW3BdO1xyXG4gICAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGUuaW5kZXhPZihwW2ldKSA8IDAgJiYgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHMsIHBbaV0pKVxyXG4gICAgICAgICAgICAgICAgdFtwW2ldXSA9IHNbcFtpXV07XHJcbiAgICAgICAgfVxyXG4gICAgcmV0dXJuIHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2RlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19wYXJhbShwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSkge1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXRlcih0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2dlbmVyYXRvcih0aGlzQXJnLCBib2R5KSB7XHJcbiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xyXG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcclxuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XHJcbiAgICAgICAgd2hpbGUgKF8pIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcclxuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcclxuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cclxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHZhciBfX2NyZWF0ZUJpbmRpbmcgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XHJcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xyXG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xyXG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcclxuICAgIG9bazJdID0gbVtrXTtcclxufSk7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHBvcnRTdGFyKG0sIG8pIHtcclxuICAgIGZvciAodmFyIHAgaW4gbSkgaWYgKHAgIT09IFwiZGVmYXVsdFwiICYmICFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobywgcCkpIF9fY3JlYXRlQmluZGluZyhvLCBtLCBwKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fdmFsdWVzKG8pIHtcclxuICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7XHJcbiAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTtcclxuICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gXCJudW1iZXJcIikgcmV0dXJuIHtcclxuICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gXCJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLlwiIDogXCJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZWFkKG8sIG4pIHtcclxuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXTtcclxuICAgIGlmICghbSkgcmV0dXJuIG87XHJcbiAgICB2YXIgaSA9IG0uY2FsbChvKSwgciwgYXIgPSBbXSwgZTtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgd2hpbGUgKChuID09PSB2b2lkIDAgfHwgbi0tID4gMCkgJiYgIShyID0gaS5uZXh0KCkpLmRvbmUpIGFyLnB1c2goci52YWx1ZSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH1cclxuICAgIGZpbmFsbHkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpW1wicmV0dXJuXCJdKSkgbS5jYWxsKGkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmaW5hbGx5IHsgaWYgKGUpIHRocm93IGUuZXJyb3I7IH1cclxuICAgIH1cclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuLyoqIEBkZXByZWNhdGVkICovXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZCgpIHtcclxuICAgIGZvciAodmFyIGFyID0gW10sIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgIGFyID0gYXIuY29uY2F0KF9fcmVhZChhcmd1bWVudHNbaV0pKTtcclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuLyoqIEBkZXByZWNhdGVkICovXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZEFycmF5cygpIHtcclxuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xyXG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxyXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxyXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcclxuICAgIHJldHVybiByO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWRBcnJheSh0bywgZnJvbSwgcGFjaykge1xyXG4gICAgaWYgKHBhY2sgfHwgYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgZm9yICh2YXIgaSA9IDAsIGwgPSBmcm9tLmxlbmd0aCwgYXI7IGkgPCBsOyBpKyspIHtcclxuICAgICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7XHJcbiAgICAgICAgICAgIGlmICghYXIpIGFyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSwgMCwgaSk7XHJcbiAgICAgICAgICAgIGFyW2ldID0gZnJvbVtpXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdG8uY29uY2F0KGFyIHx8IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20pKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXQodikge1xyXG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jR2VuZXJhdG9yKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgaWYgKGdbbl0pIGlbbl0gPSBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIGIpIHsgcS5wdXNoKFtuLCB2LCBhLCBiXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7IHRyeSB7IHN0ZXAoZ1tuXSh2KSk7IH0gY2F0Y2ggKGUpIHsgc2V0dGxlKHFbMF1bM10sIGUpOyB9IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAocikgeyByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdCA/IFByb21pc2UucmVzb2x2ZShyLnZhbHVlLnYpLnRoZW4oZnVsZmlsbCwgcmVqZWN0KSA6IHNldHRsZShxWzBdWzJdLCByKTsgfVxyXG4gICAgZnVuY3Rpb24gZnVsZmlsbCh2YWx1ZSkgeyByZXN1bWUoXCJuZXh0XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7IHJlc3VtZShcInRocm93XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKGYsIHYpIHsgaWYgKGYodiksIHEuc2hpZnQoKSwgcS5sZW5ndGgpIHJlc3VtZShxWzBdWzBdLCBxWzBdWzFdKTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0RlbGVnYXRvcihvKSB7XHJcbiAgICB2YXIgaSwgcDtcclxuICAgIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiwgZnVuY3Rpb24gKGUpIHsgdGhyb3cgZTsgfSksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4sIGYpIHsgaVtuXSA9IG9bbl0gPyBmdW5jdGlvbiAodikgeyByZXR1cm4gKHAgPSAhcCkgPyB7IHZhbHVlOiBfX2F3YWl0KG9bbl0odikpLCBkb25lOiBuID09PSBcInJldHVyblwiIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xyXG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcclxuICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XHJcbiAgICByZXR1cm4gY29va2VkO1xyXG59O1xyXG5cclxudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9IE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xyXG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcclxuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydFN0YXIobW9kKSB7XHJcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xyXG4gICAgdmFyIHJlc3VsdCA9IHt9O1xyXG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xyXG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydERlZmF1bHQobW9kKSB7XHJcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IGRlZmF1bHQ6IG1vZCB9O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEdldChyZWNlaXZlciwgc3RhdGUsIGtpbmQsIGYpIHtcclxuICAgIGlmIChraW5kID09PSBcImFcIiAmJiAhZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgYWNjZXNzb3Igd2FzIGRlZmluZWQgd2l0aG91dCBhIGdldHRlclwiKTtcclxuICAgIGlmICh0eXBlb2Ygc3RhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHJlY2VpdmVyICE9PSBzdGF0ZSB8fCAhZiA6ICFzdGF0ZS5oYXMocmVjZWl2ZXIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IHJlYWQgcHJpdmF0ZSBtZW1iZXIgZnJvbSBhbiBvYmplY3Qgd2hvc2UgY2xhc3MgZGlkIG5vdCBkZWNsYXJlIGl0XCIpO1xyXG4gICAgcmV0dXJuIGtpbmQgPT09IFwibVwiID8gZiA6IGtpbmQgPT09IFwiYVwiID8gZi5jYWxsKHJlY2VpdmVyKSA6IGYgPyBmLnZhbHVlIDogc3RhdGUuZ2V0KHJlY2VpdmVyKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fY2xhc3NQcml2YXRlRmllbGRTZXQocmVjZWl2ZXIsIHN0YXRlLCB2YWx1ZSwga2luZCwgZikge1xyXG4gICAgaWYgKGtpbmQgPT09IFwibVwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBtZXRob2QgaXMgbm90IHdyaXRhYmxlXCIpO1xyXG4gICAgaWYgKGtpbmQgPT09IFwiYVwiICYmICFmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBhY2Nlc3NvciB3YXMgZGVmaW5lZCB3aXRob3V0IGEgc2V0dGVyXCIpO1xyXG4gICAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gXCJmdW5jdGlvblwiID8gcmVjZWl2ZXIgIT09IHN0YXRlIHx8ICFmIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3Qgd3JpdGUgcHJpdmF0ZSBtZW1iZXIgdG8gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdFwiKTtcclxuICAgIHJldHVybiAoa2luZCA9PT0gXCJhXCIgPyBmLmNhbGwocmVjZWl2ZXIsIHZhbHVlKSA6IGYgPyBmLnZhbHVlID0gdmFsdWUgOiBzdGF0ZS5zZXQocmVjZWl2ZXIsIHZhbHVlKSksIHZhbHVlO1xyXG59XHJcbiIsImltcG9ydCAnLi9zdHlsZXMvc3R5bGVzLmNzcyc7XG5cbmltcG9ydCB7IFBsdWdpbiwgVEZpbGUsIEFwcCwgVmF1bHQsIFdvcmtzcGFjZSwgTW9kYWwsIE1hcmtkb3duVmlldywgRWRpdG9yUG9zaXRpb24sIFN1Z2dlc3RNb2RhbCB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IHJlc29sdmUgfSBmcm9tICdwYXRoJztcblxuY29uc3QgcmVnZXggPSAvXihbMC05XSspKD86LShbYS16XSspLShbMC05XSspPyk/XFwubWQkLztcbmNvbnN0IGxldHRlcnNJRENvbXBvbmVudFN1Y2Nlc3NvcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG4gICAgJ2EnOiAnYicsXG4gICAgJ2InOiAnYycsIFxuICAgICdjJzogJ2QnLCBcbiAgICAnZCc6ICdlJywgXG4gICAgJ2UnOiAnZicsIFxuICAgICdmJzogJ2cnLCBcbiAgICAnZyc6ICdoJywgXG4gICAgJ2gnOiAnaScsIFxuICAgICdpJzogJ2onLCBcbiAgICAnaic6ICdrJywgXG4gICAgJ2snOiAnbCcsIFxuICAgICdsJzogJ20nLCBcbiAgICAnbSc6ICduJywgXG4gICAgJ24nOiAnbycsIFxuICAgICdvJzogJ3AnLCBcbiAgICAncCc6ICdxJywgXG4gICAgJ3EnOiAncicsIFxuICAgICdyJzogJ3MnLCBcbiAgICAncyc6ICd0JywgXG4gICAgJ3QnOiAndScsIFxuICAgICd1JzogJ3YnLCBcbiAgICAndic6ICd3JywgXG4gICAgJ3cnOiAneCcsIFxuICAgICd4JzogJ3knLCBcbiAgICAneSc6ICd6JywgXG4gICAgJ3onOiAnYWEnIFxufTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTmV3WmV0dGVsIGV4dGVuZHMgUGx1Z2luIHtcblxuICAgIGNvcHlUb0NsaXBib2FyZChkYXRhOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgbGlzdGVuZXIgPSAoZTogQ2xpcGJvYXJkRXZlbnQpID0+IHtcbiAgICAgICAgICAgIGUuY2xpcGJvYXJkRGF0YT8uc2V0RGF0YSgndGV4dC9wbGFpbicsIGRhdGEpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29weScsIGxpc3RlbmVyKTtcbiAgICAgICAgfTtcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY29weScsIGxpc3RlbmVyKTtcbiAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2NvcHknKTtcbiAgICB9XG4gICAgXG4gICAgaW5jcmVtZW50U3RyaW5nSURDb21wb25lbnQoaWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGxldCBjb21wcyA9IGlkLnNwbGl0KFwiXCIpXG4gICAgICAgIGxldCBsYXN0ID0gY29tcHMucG9wKCkhXG4gICAgICAgIHJldHVybiBjb21wcy5jb25jYXQoW2xldHRlcnNJRENvbXBvbmVudFN1Y2Nlc3NvcnNbbGFzdF1dKS5qb2luKFwiXCIpXG4gICAgfVxuXG4gICAgaW5jcmVtZW50TnVtYmVySURDb21wb25lbnQoaWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiAocGFyc2VJbnQoaWQpICsgMSkudG9TdHJpbmcoKVxuICAgIH1cblxuICAgIGlzTnVtYmVyKHN0cmluZzogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAvXlxcZCskLy50ZXN0KHN0cmluZylcbiAgICB9XG4gICAgaW5jcmVtZW50SURDb21wb25lbnQoaWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGlmICh0aGlzLmlzTnVtYmVyKGlkKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5jcmVtZW50TnVtYmVySURDb21wb25lbnQoaWQpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbmNyZW1lbnRTdHJpbmdJRENvbXBvbmVudChpZClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGluY3JlbWVudElEKGlkOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICB2YXIgcGFydHMgPSBpZC5tYXRjaCgvKFswLTldK3xbYS16XSspL2cpIVxuICAgICAgICB2YXIgbGFzdFBhcnQgPSBwYXJ0cy5wb3AoKSFcbiAgICAgICAgcmV0dXJuIHBhcnRzLmNvbmNhdChbdGhpcy5pbmNyZW1lbnRJRENvbXBvbmVudChsYXN0UGFydCldKS5qb2luKFwiXCIpXG4gICAgfVxuXG4gICAgcGFyZW50SUQoaWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHZhciBwYXJ0cyA9IGlkLm1hdGNoKC8oWzAtOV0rfFthLXpdKykvZykhXG4gICAgICAgIGlmIChwYXJ0cykge1xuICAgICAgICAgICAgcGFydHMucG9wKClcbiAgICAgICAgICAgIHJldHVybiBwYXJ0cy5qb2luKFwiXCIpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCJcIlxuICAgICAgICB9XG5cbiAgICB9XG4gICAgbmV4dENvbXBvbmVudE9mKGlkOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICB2YXIgcGFydHMgPSBpZC5tYXRjaCgvKFswLTldK3xbYS16XSspL2cpIVxuICAgICAgICB2YXIgbGFzdFBhcnQgPSBwYXJ0cy5wb3AoKSFcbiAgICAgICAgaWYgKHRoaXMuaXNOdW1iZXIobGFzdFBhcnQpKSB7IFxuICAgICAgICAgICAgcmV0dXJuIFwiYVwiXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCIxXCJcbiAgICAgICAgfVxuICAgIH1cbiAgICBmaXJzdENoaWxkT2YocGFyZW50SUQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBwYXJlbnRJRCArIHRoaXMubmV4dENvbXBvbmVudE9mKHBhcmVudElEKVxuICAgIH1cblxuICAgIGlkRXhpc3RzKGlkOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMoKS5maWx0ZXIoZnVuY3Rpb24gKGZpbGUpIHsgcmV0dXJuIGZpbGUuYmFzZW5hbWUgPT0gaWQgfSkubGVuZ3RoICE9IDBcbiAgICB9XG5cbiAgICBmaXJzdEF2YWlsYWJsZUlEKHN0YXJ0aW5nSUQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHZhciBuZXh0SUQgPSBzdGFydGluZ0lEXG4gICAgICAgIHdoaWxlKHRoaXMuaWRFeGlzdHMobmV4dElEKSkgeyBuZXh0SUQgPSB0aGlzLmluY3JlbWVudElEKG5leHRJRCkgfVxuICAgICAgICByZXR1cm4gbmV4dElEXG4gICAgfVxuXG4gICAgbWFrZU5vdGVGb3JOZXh0U2libGluZ09mKHNpYmxpbmc6IFRGaWxlKTogc3RyaW5nIHtcbiAgICAgICAgdmFyIG5leHRJRCA9IHRoaXMuZmlyc3RBdmFpbGFibGVJRCh0aGlzLmluY3JlbWVudElEKHNpYmxpbmcuYmFzZW5hbWUpKVxuICAgICAgICBsZXQgbmV4dFBhdGggPSB0aGlzLmFwcC5maWxlTWFuYWdlci5nZXROZXdGaWxlUGFyZW50KHNpYmxpbmcucGF0aCkucGF0aCArIFwiL1wiICsgbmV4dElEICsgXCIubWRcIlxuICAgICAgICByZXR1cm4gbmV4dElEXG4gICAgfVxuXG4gICAgbWFrZU5vdGVGb3JOZXh0Q2hpbGRPZihwYXJlbnQ6IFRGaWxlKTogc3RyaW5nIHtcbiAgICAgICAgdmFyIGNoaWxkSUQgPSB0aGlzLmZpcnN0QXZhaWxhYmxlSUQodGhpcy5maXJzdENoaWxkT2YocGFyZW50LmJhc2VuYW1lKSlcbiAgICAgICAgbGV0IG5leHRQYXRoID0gdGhpcy5hcHAuZmlsZU1hbmFnZXIuZ2V0TmV3RmlsZVBhcmVudChwYXJlbnQucGF0aCkucGF0aCArIFwiL1wiICsgY2hpbGRJRCArIFwiLm1kXCJcbiAgICAgICAgcmV0dXJuIGNoaWxkSURcbiAgICB9XG5cbiAgICBtYWtlTm90ZShwYXRoOiBzdHJpbmcsIHRpdGxlOiBzdHJpbmcsIGNvbnRlbnQ6IHN0cmluZywgcGxhY2VDdXJzb3JBdFN0YXJ0T2ZDb250ZW50OiBib29sZWFuKSB7XG4gICAgICAgIGxldCBhcHAgPSB0aGlzLmFwcFxuICAgICAgICBsZXQgdGl0bGVDb250ZW50ID0gXCIjIFwiICsgdGl0bGUgKyBcIlxcblxcblwiXG4gICAgICAgIGxldCBmdWxsQ29udGVudCA9IHRpdGxlQ29udGVudCArIGNvbnRlbnRcbiAgICAgICAgdGhpcy5hcHAudmF1bHQuY3JlYXRlKHBhdGgsICBmdWxsQ29udGVudCkudGhlbiAoZnVuY3Rpb24gKGZpbGUpIHtcbiAgICAgICAgICAgIGFwcC53b3Jrc3BhY2UuYWN0aXZlTGVhZj8ub3BlbkZpbGUoZmlsZSkudGhlbiAoZnVuY3Rpb24gKGZpbGUpIHtcbiAgICAgICAgICAgICAgICBsZXQgZWRpdG9yID0gYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk/LmVkaXRvclxuICAgICAgICAgICAgICAgIGlmIChwbGFjZUN1cnNvckF0U3RhcnRPZkNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHBvc2l0aW9uOiBFZGl0b3JQb3NpdGlvbiA9IHsgbGluZTogMiwgY2g6IDB9XG4gICAgICAgICAgICAgICAgICAgIGVkaXRvcj8uc2V0Q3Vyc29yKHBvc2l0aW9uKVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGVkaXRvcj8uZXhlYygnZ29FbmQnKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgaXNaZXR0ZWxGaWxlKG5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gL14oKD86WzAtOV0rfFthLXpdKykrKVxcLm1kJC8uZXhlYyhuYW1lKSAhPSBudWxsXG4gICAgfVxuXG4gICAgbWFrZU5vdGVGdW5jdGlvbihpZEdlbmVyYXRvcjogKChmaWxlOiBURmlsZSkgPT4gc3RyaW5nKSkge1xuICAgICAgICB2YXIgZmlsZSA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlKClcbiAgICAgICAgaWYgKGZpbGUgPT0gbnVsbCkgeyByZXR1cm4gfVxuICAgICAgICBpZiAodGhpcy5pc1pldHRlbEZpbGUoZmlsZS5uYW1lKSkge1xuICAgICAgICAgICAgbGV0IGZpbGVJRCA9IGZpbGUuYmFzZW5hbWVcbiAgICAgICAgICAgIGxldCBmaWxlTGluayA9IFwiW1tcIiArIGZpbGVJRCArIFwiXV1cIlxuICAgICAgICAgICAgbGV0IGVkaXRvciA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk/LmVkaXRvclxuICAgICAgICAgICAgbGV0IHNlbGVjdGlvbiA9IGVkaXRvcj8uZ2V0U2VsZWN0aW9uKClcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbGV0IG5leHRJRCA9IGlkR2VuZXJhdG9yLmJpbmQodGhpcywgZmlsZSkoKVxuICAgICAgICAgICAgbGV0IG5leHRQYXRoID0gdGhpcy5hcHAuZmlsZU1hbmFnZXIuZ2V0TmV3RmlsZVBhcmVudChmaWxlLnBhdGgpLnBhdGggKyBcIi9cIiArIG5leHRJRCArIFwiLm1kXCJcbiAgICAgICAgICAgIGxldCBuZXdMaW5rID0gXCJbW1wiICsgbmV4dElEICsgXCJdXVwiXG5cbiAgICAgICAgICAgIGlmIChzZWxlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBsZXQgdGl0bGUgPSAgc2VsZWN0aW9uLnNwbGl0KC9cXHMrLykubWFwKHcgPT4gd1swXS50b1VwcGVyQ2FzZSgpICsgdy5zbGljZSgxKSkuam9pbignICcpO1xuICAgICAgICAgICAgICAgIGxldCBzZWxlY3Rpb25Qb3MgPSBlZGl0b3IhLmxpc3RTZWxlY3Rpb25zKClbMF1cbiAgICAgICAgICAgICAgICBsZXQgcG9zaXRpb25DSCA9IE1hdGgubWF4KHNlbGVjdGlvblBvcy5oZWFkLmNoLCBzZWxlY3Rpb25Qb3MuYW5jaG9yLmNoKVxuICAgICAgICAgICAgICAgIGxldCBwb3NpdGlvbjogRWRpdG9yUG9zaXRpb24gPSB7IGxpbmU6IHNlbGVjdGlvblBvcy5hbmNob3IubGluZSwgY2g6IHBvc2l0aW9uQ0ggKyAxIH1cbiAgICAgICAgICAgICAgICBlZGl0b3IhLnJlcGxhY2VSYW5nZShcIiBcIiArIG5ld0xpbmssIHBvc2l0aW9uLCBwb3NpdGlvbilcbiAgICAgICAgICAgICAgICB0aGlzLm1ha2VOb3RlKG5leHRQYXRoLCB0aXRsZSwgZmlsZUxpbmssIHRydWUpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG5ldyBOZXdaZXR0ZWxNb2RhbCh0aGlzLmFwcCwgKHRpdGxlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnNlcnRUZXh0SW50b0N1cnJlbnROb3RlKG5ld0xpbmspXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWFrZU5vdGUobmV4dFBhdGgsIHRpdGxlLCBmaWxlTGluaywgdHJ1ZSlcbiAgICAgICAgICAgICAgICB9KS5vcGVuKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIHJlbmFtZVpldHRlbChpZDogc3RyaW5nLCB0b05hbWU6IHN0cmluZykge1xuICAgICAgICBsZXQgemV0dGVsID0gdGhpcy5hcHAudmF1bHQuZ2V0TWFya2Rvd25GaWxlcygpLmZpbHRlcigoZmlsZSkgPT4gZmlsZS5iYXNlbmFtZSA9PSBpZCkuZmlyc3QoKVxuICAgICAgICBpZiAoemV0dGVsKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZUxpbmtzKGlkLCB0b05hbWUpXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZW5hbWUoemV0dGVsLCB6ZXR0ZWwucGFyZW50LnBhdGggKyB0b05hbWUgKyBcIi5cIiArIHpldHRlbC5leHRlbnNpb24pXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyB1cGRhdGVMaW5rcyhmcm9tSUQ6IHN0cmluZywgdG9JRDogc3RyaW5nKSB7XG4gICAgICAgIGxldCBmcm9tTGluayA9IFwiW1tcIiArIGZyb21JRCArIFwiXV1cIlxuICAgICAgICBsZXQgdG9MaW5rID0gXCJbW1wiICsgdG9JRCArIFwiXV1cIlxuICAgICAgICBsZXQgbWF0Y2hpbmdGaWxlczogW1RGaWxlLCBzdHJpbmddW10gPSBbXVxuICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgdGhpcy5nZXRaZXR0ZWxzKCkpIHtcbiAgICAgICAgICAgIGxldCBjb250ZW50cyA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSlcbiAgICAgICAgICAgIGlmIChjb250ZW50cy5jb250YWlucyhmcm9tTGluaykpIHtcbiAgICAgICAgICAgICAgICBtYXRjaGluZ0ZpbGVzID0gbWF0Y2hpbmdGaWxlcy5jb25jYXQoW1tmaWxlLCBjb250ZW50c11dKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChjb25zdCBbZmlsZSwgY29udGVudHNdIG9mIG1hdGNoaW5nRmlsZXMpIHtcbiAgICAgICAgICAgIGxldCBuZXdDb250ZW50cyA9IGNvbnRlbnRzLnJlcGxhY2UoZnJvbUxpbmssIHRvTGluaylcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShmaWxlLCBuZXdDb250ZW50cylcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIG1vdmVDaGlsZHJlbkRvd24oaWQ6IHN0cmluZykge1xuICAgICAgICBsZXQgY2hpbGRyZW4gPSB0aGlzLmdldERpcmVjdENoaWxkWmV0dGVscyhpZClcbiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBjaGlsZHJlbikge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5tb3ZlWmV0dGVsRG93bihjaGlsZC5iYXNlbmFtZSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIG1vdmVaZXR0ZWxEb3duKGlkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5tb3ZlQ2hpbGRyZW5Eb3duKGlkKVxuICAgICAgICBhd2FpdCB0aGlzLnJlbmFtZVpldHRlbChpZCwgdGhpcy5maXJzdEF2YWlsYWJsZUlEKGlkKSlcbiAgICB9XG5cbiAgICBhc3luYyBvdXRkZW50WmV0dGVsKGlkOiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IG5ld0lEID0gdGhpcy5pbmNyZW1lbnRJRCh0aGlzLnBhcmVudElEKGlkKSlcbiAgICAgICAgaWYgKHRoaXMuaWRFeGlzdHMobmV3SUQpKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLm1vdmVaZXR0ZWxEb3duKGlkKVxuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzLmdldERpcmVjdENoaWxkWmV0dGVscyhpZCkpIHtcbiAgICAgICAgICAgIGxldCBuZXdDaGlsZElEOiBzdHJpbmcgPSB0aGlzLmZpcnN0QXZhaWxhYmxlSUQodGhpcy5maXJzdENoaWxkT2YobmV3SUQpKVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5yZW5hbWVaZXR0ZWwoY2hpbGQuYmFzZW5hbWUsIG5ld0NoaWxkSUQpXG4gICAgICAgIH1cblxuICAgICAgICBhd2FpdCB0aGlzLnJlbmFtZVpldHRlbChpZCwgbmV3SUQpXG4gICAgfVxuXG4gICAgYXN5bmMgb25sb2FkKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnbG9hZGluZyBOZXcgWmV0dGVsJyk7XG4gICAgICAgIC8vIHRoaXMuYXBwLndvcmtzcGFjZS5vbkxheW91dFJlYWR5KHRoaXMuaW5pdGlhbGl6ZSk7XG5cbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcblx0XHRcdGlkOiAnbmV3LXNpYmxpbmctbm90ZScsXG5cdFx0XHRuYW1lOiAnTmV3IFNpYmxpbmcgWmV0dGVsIE5vdGUnLFxuXHRcdFx0Y2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm1ha2VOb3RlRnVuY3Rpb24odGhpcy5tYWtlTm90ZUZvck5leHRTaWJsaW5nT2YpXG5cdFx0XHR9XG5cdFx0fSk7XG5cbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcblx0XHRcdGlkOiAnbmV3LWNoaWxkLW5vdGUnLFxuXHRcdFx0bmFtZTogJ05ldyBDaGlsZCBaZXR0ZWwgTm90ZScsXG5cdFx0XHRjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubWFrZU5vdGVGdW5jdGlvbih0aGlzLm1ha2VOb3RlRm9yTmV4dENoaWxkT2YpXG5cdFx0XHR9XG5cdFx0fSk7XG5cbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcblx0XHRcdGlkOiAnaW5zZXJ0LXpldHRlbC1saW5rJyxcblx0XHRcdG5hbWU6ICdJbnNlcnQgWmV0dGVsIExpbmsnLFxuXHRcdFx0Y2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBsZXQgY29tcGxldGlvbiA9ICh0ZSlcbiAgICAgICAgICAgICAgICB0aGlzLmdldEFsbE5vdGVUaXRsZXMoKS50aGVuKCh0aXRsZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbmV3IFpldHRlbFN1Z2dlc3Rlcih0aGlzLmFwcCwgdGl0bGVzLCB0aGlzLmN1cnJlbnRseVNlbGVjdGVkVGV4dCgpLCAoZmlsZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnNlcnRUZXh0SW50b0N1cnJlbnROb3RlKFwiW1tcIiArIGZpbGUuYmFzZW5hbWUgKyBcIl1dXCIpXG4gICAgICAgICAgICAgICAgICAgIH0pLm9wZW4oKTtcbiAgICAgICAgICAgICAgICB9KVxuXHRcdFx0fVxuXHRcdH0pO1xuXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG5cdFx0XHRpZDogJ29wZW4temV0dGVsJyxcblx0XHRcdG5hbWU6ICdPcGVuIFpldHRlbCcsXG5cdFx0XHRjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIGxldCBjb21wbGV0aW9uID0gKHRlKVxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0QWxsTm90ZVRpdGxlcygpLnRoZW4oKHRpdGxlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBuZXcgWmV0dGVsU3VnZ2VzdGVyKHRoaXMuYXBwLCB0aXRsZXMsIHRoaXMuY3VycmVudGx5U2VsZWN0ZWRUZXh0KCksIChmaWxlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0VW5waW5uZWRMZWFmKCkub3BlbkZpbGUoZmlsZSlcbiAgICAgICAgICAgICAgICAgICAgfSkub3BlbigpO1xuICAgICAgICAgICAgICAgIH0pXG5cdFx0XHR9XG5cdFx0fSk7XG5cbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcblx0XHRcdGlkOiAnb3Blbi1wYXJlbnQtemV0dGVsJyxcblx0XHRcdG5hbWU6ICdPcGVuIFBhcmVudCBaZXR0ZWwnLFxuXHRcdFx0Y2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgZmlsZSA9IHRoaXMuY3VycmVudEZpbGUoKVxuICAgICAgICAgICAgICAgIGlmIChmaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3BlblpldHRlbCh0aGlzLnBhcmVudElEKGZpbGUuYmFzZW5hbWUpKVxuICAgICAgICAgICAgICAgIH1cblx0XHRcdH1cblx0XHR9KTtcblxuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuXHRcdFx0aWQ6ICdvdXRkZW50LXpldHRlbCcsXG5cdFx0XHRuYW1lOiAnT3V0ZGVudCBaZXR0ZWwnLFxuXHRcdFx0Y2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgZmlsZSA9IHRoaXMuY3VycmVudEZpbGUoKVxuICAgICAgICAgICAgICAgIGlmIChmaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3V0ZGVudFpldHRlbChmaWxlLmJhc2VuYW1lKVxuICAgICAgICAgICAgICAgIH1cblx0XHRcdH1cblx0XHR9KTtcbiAgICB9XG5cbiAgICBvbnVubG9hZCgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3VubG9hZGluZyBOZXcgWmV0dGVsJyk7XG4gICAgICAgIC8vIHRoaXMuaW5pdGlhbGl6ZSh0cnVlKTtcbiAgICB9XG5cbiAgICBjdXJyZW50RmlsZSgpOiBURmlsZSB8IHVuZGVmaW5lZCB7XG4gICAgICAgIHJldHVybiB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpPy5maWxlXG4gICAgfVxuXG4gICAgb3BlblpldHRlbChpZDogc3RyaW5nKSB7XG4gICAgICAgIGxldCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0TWFya2Rvd25GaWxlcygpLmZpbHRlcigoZmlsZSkgPT4gZmlsZS5iYXNlbmFtZSA9PSBpZCkuZmlyc3QoKVxuICAgICAgICBpZiAoZmlsZSkge1xuICAgICAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLmdldFVucGlubmVkTGVhZigpLm9wZW5GaWxlKGZpbGUpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjdXJyZW50bHlTZWxlY3RlZFRleHQoKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk/LmVkaXRvci5nZXRTZWxlY3Rpb24oKVxuICAgIH1cblxuICAgIGluc2VydFRleHRJbnRvQ3VycmVudE5vdGUodGV4dDogc3RyaW5nKSB7XG4gICAgICAgIGxldCB2aWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KVxuXG4gICAgICAgIGlmICh2aWV3KSB7XG4gICAgICAgICAgICBsZXQgZWRpdG9yID0gdmlldyEuZWRpdG9yXG4gICAgICAgIFxuICAgICAgICAgICAgbGV0IHBvc2l0aW9uOiBFZGl0b3JQb3NpdGlvblxuICAgICAgICAgICAgdmFyIHByZWZpeDogc3RyaW5nID0gXCJcIlxuXG4gICAgICAgICAgICBpZiAoZWRpdG9yLmdldFNlbGVjdGlvbigpKSB7XG4gICAgICAgICAgICAgICAgbGV0IHNlbGVjdGlvblBvcyA9IGVkaXRvci5saXN0U2VsZWN0aW9ucygpWzBdXG4gICAgICAgICAgICAgICAgbGV0IHBvc2l0aW9uQ0ggPSBNYXRoLm1heChzZWxlY3Rpb25Qb3MuaGVhZC5jaCwgc2VsZWN0aW9uUG9zLmFuY2hvci5jaClcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHsgbGluZTogc2VsZWN0aW9uUG9zLmFuY2hvci5saW5lLCBjaDogcG9zaXRpb25DSCArIDEgfVxuICAgICAgICAgICAgICAgIHByZWZpeCA9IFwiIFwiXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gZWRpdG9yLmdldEN1cnNvcigpXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVkaXRvci5yZXBsYWNlUmFuZ2UoXCIgXCIgKyB0ZXh0LCBwb3NpdGlvbiwgcG9zaXRpb24pXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRaZXR0ZWxzKCk6IFRGaWxlW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5hcHAudmF1bHQuZ2V0TWFya2Rvd25GaWxlcygpLmZpbHRlcigoZmlsZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaWdub3JlID0gL15bX2xheW91dHN8dGVtcGxhdGVzfHNjcmlwdHNdL1xuICAgICAgICAgICAgcmV0dXJuIGZpbGUucGF0aC5tYXRjaChpZ25vcmUpID09IG51bGxcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBnZXREaXJlY3RDaGlsZFpldHRlbHMob2ZQYXJlbnQ6IHN0cmluZyk6IFRGaWxlW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRaZXR0ZWxzKCkuZmlsdGVyKChmaWxlKSA9PiB7IHJldHVybiB0aGlzLnBhcmVudElEKGZpbGUuYmFzZW5hbWUpID09IG9mUGFyZW50IH0pXG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0QWxsTm90ZVRpdGxlcygpOiBQcm9taXNlPE1hcDxzdHJpbmcsIFRGaWxlPj4ge1xuICAgICAgICBjb25zdCByZWdleCA9IC8jICguKylcXHMqLztcblxuICAgICAgICBsZXQgdGl0bGVzOiBNYXA8c3RyaW5nLCBURmlsZT4gPSBuZXcgTWFwKClcbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIHRoaXMuZ2V0WmV0dGVscygpKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jYWNoZWRSZWFkKGZpbGUpLnRoZW4oKHRleHQpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgbWF0Y2ggPSB0ZXh0Lm1hdGNoKHJlZ2V4KVxuICAgICAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZXMuc2V0KG1hdGNoWzFdLCBmaWxlKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGl0bGVzXG4gICAgfVxufVxuXG5jbGFzcyBOZXdaZXR0ZWxNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgICBwdWJsaWMgY29tcGxldGlvbjogKHRleHQ6IHN0cmluZykgPT4gdm9pZFxuXHRjb25zdHJ1Y3RvcihhcHA6IEFwcCwgY29tcGxldGlvbjogKCh0aXRsZTogc3RyaW5nKSA9PiB2b2lkKSkge1xuXHRcdHN1cGVyKGFwcCk7XG4gICAgICAgIHRoaXMuY29tcGxldGlvbiA9IGNvbXBsZXRpb25cblx0fVxuXG5cdG9uT3BlbigpIHtcbiAgICAgICAgbGV0IHtjb250ZW50RWx9ID0gdGhpcztcbiAgICAgICAgY29udGVudEVsLnBhcmVudEVsZW1lbnQhLmFkZENsYXNzKFwiemV0dGVsLW1vZGFsXCIpO1xuICAgICAgICB0aGlzLnRpdGxlRWwuc2V0VGV4dChcIk5ldyB6ZXR0ZWwgdGl0bGUuLi5cIik7XG4gICAgICAgIFxuICAgICAgICBsZXQgY29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZUVsKFwiZGl2XCIpXG4gICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcInpldHRlbC1tb2RhbC1jb250YWluZXJcIik7XG4gICAgICAgIFxuICAgICAgICBsZXQgdGV4dEJveCA9IGNvbnRlbnRFbC5jcmVhdGVFbChcImlucHV0XCIsIHsgXCJ0eXBlXCI6XCJ0ZXh0XCIgfSk7XG4gICAgICAgIHRleHRCb3guYWRkQ2xhc3MoXCJ6ZXR0ZWwtbW9kYWwtdGV4dGJveFwiKVxuICAgICAgICB0ZXh0Qm94LmlkID0gXCJ6ZXR0ZWwtbW9kYWwtdGV4dGJveFwiXG4gICAgICAgIHRleHRCb3guYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09IFwiRW50ZXJcIikge1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICAgICAgICB0aGlzLmdvVGFwcGVkKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmQodGV4dEJveClcbiAgICAgICAgXG4gICAgICAgIGxldCBidXR0b24gPSBjb250ZW50RWwuY3JlYXRlRWwoXCJpbnB1dFwiLCB7IFwidHlwZVwiOiBcImJ1dHRvblwiLCBcInZhbHVlXCI6IFwiR09cIiB9KVxuICAgICAgICBidXR0b24uYWRkQ2xhc3MoXCJ6ZXR0ZWwtbW9kYWwtYnV0dG9uXCIpXG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGU6RXZlbnQpID0+IHRoaXMuZ29UYXBwZWQoKSk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmQoYnV0dG9uKVxuICAgICAgICBcbiAgICAgICAgY29udGVudEVsLmFwcGVuZChjb250YWluZXIpXG5cbiAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGV4dEJveC5mb2N1cygpO1xuICAgICAgICB9LCAwKTtcbiAgICB9XG5cbiAgICBnb1RhcHBlZCgpIHtcbiAgICAgICAgbGV0IHRpdGxlID0gKDxIVE1MSW5wdXRFbGVtZW50PnRoaXMuY29udGVudEVsLm93bmVyRG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ6ZXR0ZWwtbW9kYWwtdGV4dGJveFwiKSkudmFsdWVcbiAgICAgICAgdGhpcy5jb21wbGV0aW9uKHRpdGxlKVxuICAgICAgICB0aGlzLmNsb3NlKClcbiAgICB9XG59XG5cbmNsYXNzIFpldHRlbFN1Z2dlc3RlciBleHRlbmRzIFN1Z2dlc3RNb2RhbDxzdHJpbmc+IHtcbiAgICBwcml2YXRlIHRpdGxlczogTWFwPHN0cmluZywgVEZpbGU+XG4gICAgcHJpdmF0ZSBjb21wbGV0aW9uOiAoZmlsZTogVEZpbGUpID0+IHZvaWRcbiAgICBwcml2YXRlIGluaXRpYWxRdWVyeTogc3RyaW5nXG5cdGNvbnN0cnVjdG9yKGFwcDogQXBwLCB0aXRsZXM6IE1hcDxzdHJpbmcsIFRGaWxlPiwgc2VhcmNoOiBzdHJpbmcgfCB1bmRlZmluZWQsIGNvbXBsZXRpb246IChmaWxlOiBURmlsZSkgPT4gdm9pZCkge1xuXHRcdHN1cGVyKGFwcCk7XG4gICAgICAgIHRoaXMuaW5pdGlhbFF1ZXJ5ID0gc2VhcmNoID8/IFwiXCJcbiAgICAgICAgdGhpcy50aXRsZXMgPSB0aXRsZXNcbiAgICAgICAgdGhpcy5jb21wbGV0aW9uID0gY29tcGxldGlvblxuXHR9XG5cbiAgICBvbk9wZW4oKSB7XG4gICAgICAgIHN1cGVyLm9uT3BlbigpXG4gICAgICAgIHRoaXMuaW5wdXRFbC52YWx1ZSA9IHRoaXMuaW5pdGlhbFF1ZXJ5XG4gICAgICAgIHZhciBldmVudCA9IG5ldyBFdmVudCgnaW5wdXQnKTtcbiAgICAgICAgdGhpcy5pbnB1dEVsLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuICAgIH1cblxuICAgIGdldFN1Z2dlc3Rpb25zKHF1ZXJ5OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgICAgIGxldCBzYW5pdGlzZWRRdWVyeSA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCkucmVwbGFjZShcIiBcIiwgXCJcIilcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy50aXRsZXMua2V5cygpKS5maWx0ZXIoKHRpdGxlKSA9PiB7IFxuICAgICAgICAgICAgbGV0IHNhbml0aXNlZFRpdGxlID0gdGl0bGUudG9Mb3dlckNhc2UoKS5yZXBsYWNlKFwiIFwiLCBcIlwiKVxuICAgICAgICAgICAgcmV0dXJuIHNhbml0aXNlZFRpdGxlLmNvbnRhaW5zKHNhbml0aXNlZFF1ZXJ5KVxuICAgICAgICB9KVxuICAgIH1cbiAgICByZW5kZXJTdWdnZXN0aW9uKHZhbHVlOiBzdHJpbmcsIGVsOiBIVE1MRWxlbWVudCkge1xuICAgICAgICBlbC5zZXRUZXh0KHZhbHVlKVxuICAgIH1cbiAgICBvbkNob29zZVN1Z2dlc3Rpb24oaXRlbTogc3RyaW5nLCBldnQ6IEtleWJvYXJkRXZlbnQgfCBNb3VzZUV2ZW50KSB7XG4gICAgICAgIHRoaXMuY29tcGxldGlvbih0aGlzLnRpdGxlcy5nZXQoaXRlbSkhKVxuICAgIH1cblxufSJdLCJuYW1lcyI6WyJQbHVnaW4iLCJNYXJrZG93blZpZXciLCJNb2RhbCIsIlN1Z2dlc3RNb2RhbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXVEQTtBQUNPLFNBQVMsU0FBUyxDQUFDLE9BQU8sRUFBRSxVQUFVLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRTtBQUM3RCxJQUFJLFNBQVMsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLE9BQU8sS0FBSyxZQUFZLENBQUMsR0FBRyxLQUFLLEdBQUcsSUFBSSxDQUFDLENBQUMsVUFBVSxPQUFPLEVBQUUsRUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRTtBQUNoSCxJQUFJLE9BQU8sS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLE9BQU8sQ0FBQyxFQUFFLFVBQVUsT0FBTyxFQUFFLE1BQU0sRUFBRTtBQUMvRCxRQUFRLFNBQVMsU0FBUyxDQUFDLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7QUFDbkcsUUFBUSxTQUFTLFFBQVEsQ0FBQyxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7QUFDdEcsUUFBUSxTQUFTLElBQUksQ0FBQyxNQUFNLEVBQUUsRUFBRSxNQUFNLENBQUMsSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDLEVBQUU7QUFDdEgsUUFBUSxJQUFJLENBQUMsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsVUFBVSxJQUFJLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7QUFDOUUsS0FBSyxDQUFDLENBQUM7QUFDUDs7QUN2RUEsTUFBTSw0QkFBNEIsR0FBMkI7SUFDekQsR0FBRyxFQUFFLEdBQUc7SUFDUixHQUFHLEVBQUUsR0FBRztJQUNSLEdBQUcsRUFBRSxHQUFHO0lBQ1IsR0FBRyxFQUFFLEdBQUc7SUFDUixHQUFHLEVBQUUsR0FBRztJQUNSLEdBQUcsRUFBRSxHQUFHO0lBQ1IsR0FBRyxFQUFFLEdBQUc7SUFDUixHQUFHLEVBQUUsR0FBRztJQUNSLEdBQUcsRUFBRSxHQUFHO0lBQ1IsR0FBRyxFQUFFLEdBQUc7SUFDUixHQUFHLEVBQUUsR0FBRztJQUNSLEdBQUcsRUFBRSxHQUFHO0lBQ1IsR0FBRyxFQUFFLEdBQUc7SUFDUixHQUFHLEVBQUUsR0FBRztJQUNSLEdBQUcsRUFBRSxHQUFHO0lBQ1IsR0FBRyxFQUFFLEdBQUc7SUFDUixHQUFHLEVBQUUsR0FBRztJQUNSLEdBQUcsRUFBRSxHQUFHO0lBQ1IsR0FBRyxFQUFFLEdBQUc7SUFD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
